jQuery(document).ready(function(){function s(){var e=jQuery("li[class^=um-groups-tab-slug_].active").find(".count");if(e){var t=parseInt(e.text())-1;e.text(t),t<=0&&window.location.reload()}}jQuery(document).on("click",".um-groups-btn-join",function(){var t=jQuery(this),e=t.data("group_id"),o=t.parents("div.actions");jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_join_group",group_id:e,nonce:um_scripts.nonce}}).done(function(e){1==e.status&&(t.addClass("um-groups-btn-leave"),t.removeClass("um-groups-btn-join"),t.text(e.labels.leave),t.addClass("um-groups-btn-join-request"),"public"==e.privacy?(o.find("ul").find("li.count-members").find("span").text(e.members),t.addClass("um-groups-has-joined")):"hidden"==e.privacy&&t.hide())}).error(function(e){console.log("join group error",e)})}),jQuery(document).on("click",".um-groups-btn-leave",function(){var t=jQuery(this),e=t.data("group_id"),o=t.parents("div.actions");jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_leave_group",group_id:e,nonce:um_scripts.nonce}}).done(function(e){e.status&&(t.addClass("um-groups-btn-join"),t.removeClass("um-groups-btn-leave"),t.removeClass("um-groups-btn-join-request"),t.text(e.labels.join),t.attr("data-groups-button-hover",e.labels.hover),"public"!=e.privacy&&"private"!=e.privacy||o.find("ul").find("li.count-members").find("span").text(e.members),"hidden"!=e.privacy&&"private"!=e.privacy||window.location.reload())}).error(function(e){console.log("leave group error",e)})}),jQuery(document).on({mouseenter:function(){var e=jQuery(this),t=e.attr("data-groups-button-hover");t&&e.text(t),e.addClass("um-groups-btn-leave")},mouseleave:function(){var e=jQuery(this),t=e.attr("data-groups-button-default");t&&e.text(t),e.removeClass("um-groups-btn-leave")}},".um-groups-single-button a.um-button:not(.um-groups-btn-join,.um-groups-has-joined)"),jQuery(document).on({mouseenter:function(){var e=jQuery(this);e.removeClass("disabled"),e.html('<span class="um-faicon-paper-plane-o"></span> '+um_scripts.groups_settings.labels.resend)},mouseleave:function(){var e=jQuery(this);e.addClass("disabled"),e.html('<span class="um-faicon-check"></span> '+um_scripts.groups_settings.labels.invited)}},'#um-group-buttons .um-group-button[data-action-key="resend_invite"]:not(.um-groups-has-invited)'),jQuery(document).on({mouseenter:function(){var e=jQuery(this);e.find("td").find("select").show(),e.find("td").find("span.label").hide()},mouseleave:function(){var e=jQuery(this);e.find("td").find("select").hide(),e.find("td").find("span.label").show()}},"table#um_groups_manage_members tbody tr"),jQuery("ul.um-groups-single-tabs li:first a").on("click",function(){window.location.href=jQuery(this).attr("href")}),jQuery(document).on("click",".um-groups-confirm-invite",function(){var e=jQuery(this).attr("data-user_id"),t=jQuery('input[name="group_id"]').val();jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_confirm_invite",group_id:t,user_id:e,self:!0,nonce:um_scripts.nonce}}).done(function(e){window.location.reload()}).error(function(e){console.log(e)})}),jQuery(document).on("click",".um-groups-ignore-invite",function(){var e=jQuery(this).attr("data-user_id"),t=jQuery('input[name="group_id"]').val();jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_ignore_invite",group_id:t,user_id:e,nonce:um_scripts.nonce}}).done(function(e){window.location.reload()}).error(function(e){console.log(e)})}),jQuery(document).on("click",".um-group-buttons a.um-group-button-more",function(){var e=jQuery(this);jQuery(".um-group-buttons a.um-group-button-more.active").removeClass("active");var t=e.parent(".um-group-buttons").find("ul[class=um-group-buttons-more]");return t.is(":visible")?t.hide():(jQuery("ul[class=um-group-buttons-more]").hide(),t.show(),e.addClass("active")),!1}),jQuery(document.body).on("click",".um-group-buttons a[data-action-key]",function(){var t=jQuery(this),o=t.parents(".um-groups-user-wrap"),e=t.data("action-key"),r=o.data("group-id"),u=o.data("group-uid");jQuery(".um-groups-single").find(".um-group-members-count").find(".count");switch(e){case"approve":jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_approve_user",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){1==e.status&&(o.fadeOut(),s())}).error(function(e){console.log("approve member error",e)});break;case"invite":t.hasClass("um-groups-has-invited")||jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_send_invitation_mail",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){e.found&&(t.addClass("disabled"),t.addClass("um-groups-has-invited"),t.html('<span class="um-faicon-check"></span> '+um_scripts.groups_settings.labels.invited))}).error(function(e){console.log("send invite error",e)});break;case"resend_invite":t.hasClass("um-groups-has-invited")||jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_send_invitation_mail",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){e.found&&(t.addClass("disabled"),t.addClass("um-groups-has-invited"),t.html('<span class="um-faicon-check"></span> '+um_scripts.groups_settings.labels.resent_invite))}).error(function(e){console.log("resend invite error",e)});break;case"make-admin":case"make-moderator":case"make-member":var n={action:"um_groups_change_member_role",group_id:r,user_id:u,role:e.replace("make-",""),nonce:um_scripts.nonce};jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:n}).done(function(e){e.found&&(t.html(e.menus[e.previous_role]),t.attr("data-action-key","make-"+e.previous_role))}).error(function(e){console.log("change member role error",e,n)});break;case"remove-from-group":confirm(um_scripts.groups_settings.labels.confirm_expel)&&jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_delete_member",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){e.found&&(o.fadeOut(),s())});break;case"remove-self-from-group":confirm(um_scripts.groups_settings.labels.confirm_remove_self)&&jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_delete_member",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){e.found&&(o.fadeOut(),s())});break;case"reject":jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_reject_user",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){o.fadeOut(),s()});break;case"block":jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_block_user",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){o.fadeOut(),s()});break;case"unblock":jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"post",data:{action:"um_groups_unblock_user",group_id:r,user_id:u,nonce:um_scripts.nonce}}).done(function(e){o.fadeOut(),s()})}return!1}),jQuery(document).on("click","a.um-groups-load-more",function(){jQuery(this).data("load-more");jQuery(this).text("...");var t=jQuery(this),e=t.data("user_id"),o={action:"um_groups_load_more_users",group_id:t.data("group-id"),user_id:e,status:t.data("load-more"),offset:t.data("users-offset"),nonce:um_scripts.nonce},r=jQuery("#um-groups-users-search-form input[type=text]").val();return r&&(o.keyword=r),jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"json",data:o}).done(function(e){setTimeout(function(){t.parent("div").after(e.html),t.parent("div").remove()},1e3)}).error(function(e){console.log(e)}),!1}),jQuery(document).on("keypress","#um-groups-users-search-form input[type=text]",function(e){var t=jQuery(this);if(13==e.which)return t.parent("form").trigger("submit"),!1}),jQuery(document).on("submit","#um-groups-users-search-form",function(e){var t=jQuery(this),o=jQuery("#um-groups-users-search-form"),r=o.data("group-id"),u=o.data("load-more"),n=t.find("input[type=text]").val(),s=jQuery(".um-groups-wrapper");return s.empty(),s.text("..."),jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"json",data:{action:"um_groups_load_more_users",group_id:r,status:u,keyword:n,offset:0,nonce:um_scripts.nonce}}).done(function(e){setTimeout(function(){s.empty(),s.append(e.html)},1e3)}).error(function(e){console.log(e)}),!1}),jQuery(document).on("click",".um-groups-lazy-load",function(){var t=jQuery(this),e={action:"um_groups_load_more_groups",settings:t.data("groups-pagi-settings"),nonce:um_scripts.nonce},o=t.parent(".um-groups-list-pagination"),r=parseInt(t.attr("data-groups-page"))+1;return e.settings.page=r,t.text("..."),jQuery.ajax({method:"POST",url:wp.ajax.settings.url,type:"json",data:e}).done(function(e){0==e.found.total_groups?(t.text(t.data("no-more-groups-text")),o.remove()):(t.text(t.data("load-more-text")),t.attr("data-groups-page",r),o.before(e.html)),r>=e.found.total_pages&&o.remove()}).error(function(e){t.text(um_scripts.groups_settings.labels.went_wrong)}),!1})});