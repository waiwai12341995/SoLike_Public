var UM_Conv_Ajax=!1;function um_Hide_Emobox(){var e=jQuery("span.um-message-emolist");e.is(":visible")&&e.hide()}function um_Chatbox(e){var s=e.val().length,a=e.attr("data-maxchar"),t=a-s;jQuery(".um-message-limit:visible").html(t),""!=e.val()?jQuery(".um-message-send:visible").removeClass("disabled"):jQuery(".um-message-send:visible").addClass("disabled"),a<s?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),""!=e.val()&&jQuery(".um-message-send:visible").removeClass("disabled"))}function Init_BodyConv(){jQuery(".um-profile-body.messages .um-message-autoheight").css({"max-height":"500px"}).mCustomScrollbar({theme:"dark-3",mouseWheelPixels:500}).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),jQuery(".um-message-conv").length&&jQuery(".um-message-conv").css({"max-height":"500px"}).mCustomScrollbar({theme:"dark-3",mouseWheelPixels:500,callbacks:{onScrollStart:function(){jQuery(".um-message-conv-load-more").show()},onTotalScroll:function(){var e=jQuery(this).data("user"),s=jQuery(this).find(".um-message-conv-item").length;wp.ajax.send("um_conversations_load",{data:{user_id:e,offset:s,nonce:um_scripts.nonce},success:function(e){if(""!==e){var s=jQuery(".um-message-conv-load-more").detach();jQuery(".um-message-conv .mCSB_container").append(e).append(s)}else jQuery(".um-message-conv-load-more").remove()},error:function(e){console.log(e)}})},onTotalScrollOffset:10,alwaysTriggerOffsets:!1}})}function UM_Refresh_Conv(){var s=jQuery(".um-message-ajax");if(s.length&&s.is(":visible")&&!UM_Conv_Ajax){var e=s.data("message_to"),a=s.data("conversation_id"),t=s.data("last_updated");if("new"===a)return;wp.ajax.send("um_messaging_update",{data:{message_to:e,conversation_id:a,last_updated:t,nonce:um_scripts.nonce},success:function(e){e&&(UM_Update_UTC_to_LocalTime(),0==s.find('.um-message-item[data-message_id="'+e.message_id+'"]').length&&"nothing_new"!==e.response&&(jQuery(".um-message-ajax").append(e.response),jQuery(".um-popup-autogrow").mCustomScrollbar("update").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),s.data("last_updated",e.last_updated)))},error:function(e){console.log(e)}})}}function UM_Update_UTC_to_LocalTime(){jQuery(".um-message-item-time").each(function(){if(""==jQuery(this).attr("title")||""==jQuery(this).attr("original-title")){var e=jQuery(this).attr("um-message-utc-time"),s=jQuery(this).attr("um-messsage-timestamp"),a=moment(s,"X").tz(moment.tz.guess()).format("LLLL");jQuery(this).attr("title",a),jQuery(this).attr("original-title",e)}})}jQuery(document.body).on("click",".um-login #um-submit-btn",function(){document.cookie="um_messaging_invite_login=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}),jQuery(document).ready(function(){if(jQuery(document.body).on("mouseenter",".um-message-item",function(){jQuery(this).find(".um-message-item-show-on-hover").fadeIn("fast")}),jQuery(document.body).on("mouseleave",".um-message-item",function(){jQuery(this).find(".um-message-item-show-on-hover").fadeOut("fast")}),um_messages.can_read&&setInterval(UM_Refresh_Conv,um_messages.interval),Init_BodyConv(),UM_Update_UTC_to_LocalTime(),jQuery(document.body).on("click",".um-message-unblock",function(e){e.preventDefault();var s=jQuery(this).attr("data-user_id");return jQuery(this).parents(".um-message-blocked").fadeOut("fast"),wp.ajax.send("um_messaging_unblock_user",{data:{user_id:s,nonce:um_scripts.nonce},success:function(e){UM_Update_UTC_to_LocalTime()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-blocku:not(.um-message-blocked-true)",function(e){e.preventDefault(),jQuery(this).addClass("um-message-blocked-true");var s=jQuery(this).attr("data-conversation_id"),a=jQuery(this).attr("data-other_user");return jQuery(".tipsy").remove(),jQuery(".um-message-body,.um-message-footer,.um-message-header-left").css({opacity:.5}),jQuery('.um-message-conv-item[data-conversation_id="'+s+'"]').remove(),jQuery(".um-message-footer").empty(),jQuery(".um-message-item-remove").remove(),jQuery("a.um-message-delconv").addClass("disabled"),wp.ajax.send("um_messaging_block_user",{data:{other_user:a,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-delconv.disabled",function(e){return e.preventDefault(),!1}),jQuery(document.body).on("click",".um-message-delconv",function(e){e.preventDefault();var s=jQuery(this).attr("data-conversation_id"),a=jQuery(this).attr("data-other_user");return jQuery(".tipsy").remove(),jQuery(".um-message-conv-view").length?(jQuery(".um-message-conv-item[data-conversation_id="+s+"]").remove(),jQuery(".um-message-conv-item").length&&jQuery(".um-message-conv-view").is(":visible")&&jQuery(".um-message-conv-item:first").trigger("click"),jQuery(".um-message-conv-view").empty()):remove_Modal(),0==jQuery(".um-message-conv").find(".um-message-conv-item").length&&(jQuery(".um-profile-body.messages").append('<div class="um-message-noconv"><i class="um-icon-android-chat"></i>'+um_message_i18n.no_chats_found+"</div>"),jQuery(".um-profile-body.messages").find(".um-message-conv, .um-message-conv-view").hide()),wp.ajax.send("um_messaging_delete_conversation",{data:{conversation_id:s,other_user:a,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-hide",function(e){return e.preventDefault(),remove_Modal(),!1}),jQuery(document.body).on("click",".um-login-to-msg-btn",function(e){e.preventDefault(),prepare_Modal();var s=jQuery(this).attr("data-message_to");if(jQuery("body").hasClass("um-page-members")){var a,t=document.body.className.match(/(^|\s)page-id-(\d+)(\s|$)/);t&&(a=t[2]);var o=jQuery(".um-members-pagi .current").text()}return wp.ajax.send("um_messaging_login_modal",{data:{message_to:s,page_id:a,current_page:o,nonce:um_scripts.nonce},success:function(e){if(e.content){show_Modal(e.content);var s=jQuery(".um_messaging_hidden_login").html();jQuery(".um_messaging_hidden_login").html(""),jQuery(".um-message-modal .um-message-body").append(s),jQuery(document).trigger("um_messaging_open_login_form"),jQuery(".um-message-modal #redirect_to").val(e.redirect_url),responsive_Modal(),um_responsive()}else remove_Modal()},error:function(e){console.log(e)}}),!1}),jQuery(document).on("um_before_modal_removed",function(e){if(jQuery(".um_messaging_hidden_login").length){var s=jQuery(".um-message-modal .um-message-body").html();jQuery(".um-message-modal .um-message-body").html(""),jQuery(".um_messaging_hidden_login").html(s),jQuery(document).trigger("um_messaging_close_login_form")}}),jQuery(document.body).on("click",".um-message-conv-item",function(e){if(e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":hidden"))return!1;if(jQuery(this).hasClass("active")||UM_Conv_Ajax)return!1;UM_Conv_Ajax=!0;var s=jQuery(this),a=jQuery(this).html();jQuery(this).find("img").replaceWith('<span class="um-message-cssload"><i class="um-faicon-circle-o-notch"></i></span>');var t=jQuery(this).attr("data-message_to");return window.history.pushState("string","Conversation",jQuery(this).attr("href")),wp.ajax.send("um_messaging_start",{data:{message_to:t,nonce:um_scripts.nonce},success:function(e){e&&(UM_Update_UTC_to_LocalTime(),jQuery(".um-message-conv-view").html(e),s.html(a),jQuery(".um-message-conv-item").removeClass("active"),s.addClass("active"),Init_BodyConv(),jQuery(".um-tip-n").tipsy({gravity:"n",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-w").tipsy({gravity:"w",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-e").tipsy({gravity:"e",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-s").tipsy({gravity:"s",opacity:1,offset:3,delayIn:500}),UM_Conv_Ajax=!1)},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-item-remove",function(e){e.preventDefault();var s=jQuery(this).parents(".um-message-item").attr("data-message_id"),a=jQuery(this).parents(".um-message-item").attr("data-conversation_id");return jQuery(this).parents(".um-message-item").fadeOut("fast"),wp.ajax.send("um_messaging_remove",{data:{message_id:s,conversation_id:a,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-emo",function(){jQuery("span.um-message-emolist").is(":visible")?um_Hide_Emobox():jQuery("span.um-message-emolist").show()}),jQuery(document.body).on("click",".um-message-emolist span.um-message-insert-emo",function(e){var s=jQuery(this).attr("data-emo"),a=jQuery(".um-message-textarea textarea");a.val(a.val()+" "+s),um_Hide_Emobox(),um_Chatbox(a),a.focus()}),jQuery(document.body).on("click",'.um-message-btn:not(.um-login-to-msg-btn), *[data-trigger_modal="conversation"]',function(e){if(e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":visible"))return!1;var s=jQuery(this).attr("data-message_to");return jQuery(".um-message-conv-item").removeClass("active"),jQuery(this).addClass("active"),prepare_Modal(),wp.ajax.send("um_messaging_start",{data:{message_to:s,nonce:um_scripts.nonce},success:function(e){e?(show_Modal(e),responsive_Modal(),autosize(jQuery(".um-message-textarea textarea:visible"))):remove_Modal()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-send:not(.disabled)",function(){var e=jQuery(this);e.addClass("disabled");var s=e.parents(".um-message-footer").siblings(".um-message-body").data("message_to"),a=e.parents(".um-message-footer").find(".um_message_text").val();return wp.ajax.send("um_messaging_send",{data:{message_to:s,content:a,nonce:um_scripts.nonce},success:function(e){var s=jQuery(".um-message-textarea textarea:visible");UM_Update_UTC_to_LocalTime(),s.val(""),jQuery(".um-message-body:visible").find(".um-message-ajax:visible").html(e.messages).data("last_updated",e.last_updated),jQuery('[data-conversation_id="new"]').data("conversation_id",e.conversation_id).show(),jQuery(".um-gdpr-donwload-link:visible").attr("href",e.chat_history_download),e.limit_hit&&jQuery(".um-message-footer:visible").html(jQuery(".um-message-footer:visible").data("limit_hit")),jQuery(".um-message-footer:visible").find(".um-message-limit").html(s.data("maxchar")),jQuery(".um-popup-autogrow:visible").mCustomScrollbar("update").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},error:function(e){jQuery(".um-message-textarea textarea:visible").val(""),console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-send.disabled",function(e){return e.preventDefault(),!1}),jQuery(document.body).on("click","textarea.um_message_text",function(e){um_Hide_Emobox()}),jQuery(document.body).on("keyup keydown keypress","textarea.um_message_text",function(e){um_Hide_Emobox(),um_Chatbox(jQuery(this))}),jQuery(document.body).on("paste","textarea.um_message_text",function(e){var s=jQuery(this),a=e.originalEvent.clipboardData.getData("text");um_Hide_Emobox();var t=s.val().length+a.length,o=s.attr("data-maxchar"),m=o-t;jQuery(".um-message-limit:visible").html(m),s.val()+a!=""?jQuery(".um-message-send:visible").removeClass("disabled"):jQuery(".um-message-send:visible").addClass("disabled"),o<t?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),s.val()+a!=""&&jQuery(".um-message-send:visible").removeClass("disabled"))}),0<jQuery(".um-profile-nav-item.um-profile-nav-messages.active").length&&void 0!==s().conversation_id){var e=s().conversation_id;jQuery(".um-message-conv-item[data-conversation_id="+e+"]").click()}function s(){for(var e,s=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<a.length;t++)e=a[t].split("="),s.push(e[0]),s[e[0]]=e[1];return s}});